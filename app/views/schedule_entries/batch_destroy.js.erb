<% @deleted_cells.each do |cell| %>
var $cell = $('.schedule-cell[data-user-id="<%= cell[:user_id] %>"][data-date="<%= cell[:date] %>"]');
$cell.html('');
$cell.css('background-color', '#ffffff');
$cell.addClass('empty-cell');
$cell.removeData('entry-id');
<% end %>

// Update weekly days off
<% @weekly_days_off.each do |user_id, count| %>
$('.weekly-days-off-cell[data-user-id="<%= user_id %>"]').text(<%= count > 0 ? count : "''".html_safe %>);
<% end %>

// Update weekly hours
<% @weekly_hours.each do |user_id, hours| %>
$('.weekly-hours-cell[data-user-id="<%= user_id %>"]').text('<%= hours %>');
<% end %>

// Update department summary counts and user lists
<% @department_counts.each do |(dept_id, shift_id, date), data| %>
(function() {
  var $cell = $('.summary-count-cell[data-department-id="<%= dept_id %>"][data-shift-id="<%= shift_id %>"][data-date="<%= date %>"]');
  var count = <%= data[:count] %>;
  var users = '<%= j data[:users].join(",") %>';
  var notAssigned = '<%= j data[:not_assigned].join(",") %>';
  var tooltipParts = [];
  if (users) tooltipParts.push('<%= j t("schedule_groups.show.assigned") %>: ' + users.split(',').join(', '));
  if (notAssigned) tooltipParts.push('<%= j t("schedule_groups.show.not_assigned") %>: ' + notAssigned.split(',').join(', '));
  $cell.text(count > 0 ? count : '');
  $cell.attr('data-users', users);
  $cell.attr('data-not-assigned', notAssigned);
  $cell.attr('data-original-title', tooltipParts.join('<br>'));
})();
<% end %>

// Update total department headcount summary
<% @total_dept_counts.each do |(dept_id, date), count| %>
$('.total-dept-count-cell[data-department-id="<%= dept_id %>"][data-date="<%= date %>"]').text(<%= count > 0 ? count : "''".html_safe %>);
<% end %>

// Update non-working counts
<% @non_working_counts.each do |date, count| %>
$('.non-working-count-cell[data-date="<%= date %>"]').text(<%= count > 0 ? count : "''".html_safe %>);
<% end %>
